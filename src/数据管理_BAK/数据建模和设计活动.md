# **数据建模和设计活动**

## 规划数据建模（Plan for Data Modeling）

- 规划数据建模包括评估组织需求、创建标准和确定数据模型存储等任务

### 数据建模过程的可交付成果

- 图（Diagram）
  - 图以精确形式捕获需求，其描述了详细程度（概念的、逻辑的或物理的）、方案（关系型的、维度的、面向对象的、基于事实的、基于时间的或非关系型的）和该方案的表示法（信息工程、统一建模语言、对象角色建模等）
- 定义（Definitions）
  - 实体、属性和关系的定义对于保持数据模型的精度至关重要
- 尚未解决的问题（Issues and outstanding questions）
  - 数据建模过程经常出现在建模阶段无法解决的问题，负责解决或回答这些问题的人员通常不在构建数据模型的团队，因此交付的文件包括当前尚未解决的问题
    - 如学生模型中如果一个学生离开然后回来，是分配一个不同的学生编号还是保留原来的学生编号
- 血缘（Lineage）
  - 数据血缘指数据来自何处，对物理数据模型及有时的逻辑数据模型至关重要
  - 通常血缘采用源/目标映射的形式，可以捕获源系统属性及其如何转移（populate）为目标系统属性，血缘还可以在同一建模工作中追踪数据建模组件从概念到逻辑再到物理的过程
  - 数据建模期间捕获血缘的重要性
    - 数据建模者对数据需求有很强的理解并且有利于确定源属性
    - 确定源属性可以成为验证模型和映射准确性（即实际检测（reality check））的有效工具

## 构建数据模型（Build the Data Model）

- 构建模型通常严重依赖以前的分析和建模工作，需研究现有的数据模型和数据库，参考已发布的标准，并纳入任何数据需求，在研究输入内容后开始构建模型，建模是一个反复的过程

![](assets/数据建模和设计活动/建模迭代.jpg)

### 正向工程（Forward Engineering）

- 正向工程是从需求开始构建新应用程序的过程，首先完成概念数据模型以理解范围和关键术语，然后完成逻辑数据模型以记录业务解决方案，最后完成物理数据模型以记录技术解决方案

#### 概念数据建模

- 选择方案（Select Scheme）
  - 决定是否应按照关系、维度、基于事实或非关系型方案构建数据模型
- 选择表示法（Select Notation）
  - 选择方案后选择合适的表示法，如信息工程或对象角色建模，选择表示法取决于组织内的标准以及具体模型的用户对具体表示法的熟悉程度
- 完成初始概念数据模型（Complete Initial CDM）
  - 初始概念数据模型应捕获用户组的观点，不应试图弄清楚他们的观点如何与其他部门或整个组织相使用，从而使过程复杂化
    - 收集高层级概念（名词），常见的概念有时间、地理、消费者/会员/客户、产品/服务和交易（Time, Geography, Customer/Member/Client, Product/Service, and Transaction）
    - 然后收集连接这些概念的活动（动词），关系可以是双向的或涉及两个以上的概念，如消费者有多个地理位置（家庭、工作等），地理位置有很多客户，交易发生在一个地点、一个设施，向一个客户销售产品
- 合并企业术语（Incorporate Enterprise Terminology）
  - 在方框和线条中捕获到用户的观点后，通过确保与企业术语和规则的一致性来捕获企业视角（perspective），如受众概念数据模型中有一个名为Client的实体，而企业视角将这个相同的概念称为Customer，则将涉及一些协调（reconciliation）工作
- 获得签收（Obtain Sign-off）
  - 初始模型完成后确保审查模型的数据建模最佳实践及其满足需求的能力，通常通过电子邮件对模型是否准确进行验收（verification）

#### 逻辑数据建模

- 逻辑数据模型在概念数据模型的范围内捕获详细数据需求
- 分析信息需求（Analyze Information Requirements）
  - 为了识别信息需求，必须首先在一个或多个业务过程的前后关系中识别业务信息需求，业务过程需要信息产品作为输入，这些信息产品本身是其他业务过程的输出，这些信息产品的名称通常标识为用作数据建模基础的基本业务词汇，无论过程或数据是按顺序还是同时建模，有效的分析和设计都应在过程和数据建模并重的同时确保数据（名词）和过程（动词）的相对平衡
  - 需求分析包括业务需求的获取、组织、文档化、审查、细化、批准和变更控制（elicitation, organization, documentation, review, refinement, approval, and change control），某些需求确定了对数据和信息的业务需求，同时使用文字和图形来表现需求规格
  - 书面数据需求规范文档可以使用需求管理工具进行维护，通过需求文档收集的规范应仔细与数据模型捕获的需求同步，以促进影响分析（impact analysis），以便回答诸如“数据模型哪些部分代表实现需求X”或“为什么这个实体在这里”
- 分析现有文档（Analyze Existing Documentation）
  - 分析现有数据工件（包括已构建的数据模型和数据库），即使数据模型已过时，其组件也可用于启动新模型，需确保基于现有工件完成的任何工作都经过了主题专家（SME）的准确性（accuracy）和时效性（currency）验证
  - 公司经常使用具有自身数据模型的打包应用程序，如企业资源规划（ERP，Enterprise Resource Planning）系统，逻辑数据模型的创建应考虑这些数据模型，在适用的情况下使用它们或将它们映射到新的企业数据模型，此外可能有有用的数据建模模式，如对参与方角色概念进行建模的标准方法，许多行业数据模型捕获了一般行业应如何建模，如零售或制造业（retail or manufacturing），可以定制这些模式或行业数据模型以用于特定项目或计划
- 添加关联实体（Add Associative Entities）
  - 关联实体用于描述多对多（或多对多对多等）关系，关联实体从关系中涉及的实体获取标识属性（identifying attributes），并将其放入仅描述实体间关系的新实体中，这个过程允许添加属性来描述关系，如有效日期和过期日期（effective and expiration dates）
  - 关联实体可能有两个以上的父实体，关联实体可能称为图形数据库中的节点，在维度建模中，关联实体通常成为事实表
- 添加属性（Add Attributes）
  - 向概念实体添加属性，逻辑数据模型中的属性应该是原子的，其有且仅有一个数据（事实），不能被分成更小的部分
    - 如概念属性电话号码分为逻辑属性：电话类型代码（家庭、办公室、传真、移动等）、国家代码、区号、前缀、基本电话号码和扩展名
- 分配域（Assign Domains）
  - 域的作用是在项目内部和项目之间保持格式和值集的一致性
    - 学生学费金额（Student Tuition Amount）和讲师薪资金额（Instructor Salary Amount）都可以分配金额域，如标准货币域（standard currency domain）
- 分配键（Assign Keys）
  - 分配给实体的属性是键属性或非键属性，键属性有助于从所有其他实体实例中完全（只通过该属性）或部分（结合其他键元素）识别一个唯一的实体实例，非键属性描述了实体实例，但不能帮助识别唯一的实体实例
  - 需要识别主键和备用键

#### 物理数据建模

- 逻辑数据模型需要修改和调整，以使最终设计在存储应用程序中表现良好，术语表用于表示表、文件和模式（schemas），术语列用于表示列、字段和元素，术语行用于表示行、记录或实例
- 解决逻辑抽象（Resolve Logical Abstractions）
  - 逻辑抽象实体（超类型和子类型）转为物理数据库中独立对象的方法
    - 子类型吸收（Subtype absorption）：子类型实体属性作为可为空的列包含在表示超类型实体的表中
    - 超类型分区（Supertype partition）：超类型实体的属性被包含到为每个子类型创建的单独表中
- 添加属性详细信息（Add Attribute Details）
  - 向物理模型添加详细信息，如每个表和列（关系数据库）、文件和字段（非关系数据库）、模式和元素（XML数据库）的技术名称
  - 确定每个列或字段的物理域、物理数据类型和长度，为列或字段添加适当的约束（如可空性和默认值），尤其是非空约束
- 添加参考数据对象（Add Reference Data Objects）
  - 在物理模型中实现逻辑数据模型中的小型参考数据值集的方式
    - 创建一个匹配的单独码表（Create a matching separate code table）：根据模型，码表可能多到难以管理
    - 创建主共享码表（Create a master shared code table）：对于有大量码表的模型，可以将其折叠（collapse）为一个表，这意味着对参考列表的更改将更改整个表格，还要注意代码值冲突
    - 将规则或有效代码嵌入到适当的对象定义中（Embed rules or valid codes into the appropriate object’s definition）：在嵌入规则或列表的对象定义代码中创建约束，适用于仅用作另一个对象参考的代码列表（code lists that are only used as reference for one other object）
- 分配代理键（Assign Surrogate Keys）
  - 分配对业务不可见且与匹配的数据没有意义或关系的唯一键值，这是一个可选步骤，取决于自然键的大小、是否综合（composite）以及其属性是否分配了随时间变化的值
  - 如果代理键被指定为表的主键，应确保原始主键上有备用键
    - 如逻辑数据模型中Student的主键是Student First Name、Student Last Name和Student Birth Date（即一个综合主键），则在物理数据模型中Student的主键可能是代理键Student ID，此时应在Student First Name、Student Last Name和Student Birth Date中确定一个备用键
- 以性能为目的的反规范化（Denormalize for Performance）
  - 有时反规范化或添加冗余可极大地提高性能，以至于超过重复存储和同步处理的成本，维度结构（dimensional structures）是反规范化的主要手段
- 以性能为目的的索引（Index for Performance）
  - 索引是访问数据库中数据的备用途径（alternate path），用以优化查询（数据检索）性能
  - RDBMS产品支持多种类型的索引，索引可以是唯一或非唯一的、聚集（clustered）或非聚集的、分区或非分区的、单列或多列的、b-tree或位图（bitmap）或散列的（hashed）
  - 如果没有合适的索引，将恢复为读取表中的每一行（表扫描）来检索任何数据，在大表中代价非常高，尝试在大表上建立索引以支持最频繁运行的查询，使用最常引用的列，尤其是键（主键、备用键和外键）
- 以性能为目的的分区（Partition for Performance）
  - 分区策略必须重复考虑整体数据模型（维度），尤其当事实包括许多可选的维度键即稀疏（sparse）时
  - 理想情况下建议按日期键进行分区，若无法做到则要根据概要结果（profiled results）和工作量分析（workload analysis）进行研究，以提出和改进分区模型
- 创建视图（Create Views）
  - 视图可用于控制对某些数据元素的访问，或嵌入连接条件或过滤器以标准化对象或查询
  - 视图应该是需求驱动的，在很多情况下，其需要通过一个反映（mirror）逻辑数据模型和物理数据模型的开发的过程来开发（need to be developed via a process that mirrors the development of the LDM and PDM）

### 逆向工程（ Reverse Engineering）

- 逆向工程是记录现有数据库的过程
  1. 首先完成物理数据模型以了解现有系统的技术设计
  2. 然后完成逻辑数据模型以记录现有系统满足的业务解决方案
  3. 最后完成概念数据模型以记录现有系统的范围和关键术语
- 大多数数据建模工具都支持从各种数据库进行逆向工程，但创建模型元素的可读布局（readable layout）仍需要建模者
- 可选择常见的布局来启动流程，如正交（orthogonal）、维度（dimensional）和分层（hierarchical），但上下文组织（按主题域或功能对实体进行分组）在很大程度上仍是一个手动过程

## 审查数据模型（Review the Data Models）

- 模型质量控制应采用持续改进的做法，价值实现实践、支持成本和数据模型质量验证器（如数据模型记分卡）等技术都可用于评估模型的正确性、完整性和一致性（correctness, completeness, and consistency）

## 维护数据模型（Maintain the Data Models）

- 数据模型在建立后需要保持最新，在需求改变时需要更新数据模型，而且在业务过程变化时需要频繁进行更新
- 当一个模型层级需要改变时，往往相应的更高层级模型也需要改变，如将一个新列添加到物理数据模型中，通常需要将该列作为属性添加到相应的逻辑数据模型中
- 最佳实践是在每次开发迭代结束时，对最新的物理数据模型进行逆向工程，并确保其仍与对应的逻辑数据模型一致
- 很多数据建模工具有助于自动化比较物理和逻辑模型