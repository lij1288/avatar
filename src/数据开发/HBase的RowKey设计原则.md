## **HBase的RowKey设计原则**

### 原则

- 长度原则

  越短越好，不超过16字节

  数据在HFile中是按完整KeyValue存储，如果Rowkey过长，影响HFile的存储效率，rowkey-columnfamily-quaifier都不要过长

  MemStore会缓存部分数据到内存，如果Rowkey过长，不能缓存更多数据，降低检索效率

  操作系统是64位，内存8字节对齐，控制在8字节整数倍利用操作系统最佳特性

- 散列原则

  如果Rowkey按时间戳递增，时间放在低位，高位字节采用散列字段，将数据均衡分布

  如果不进行散列处理，相同时段的数据集中到一个RegionServer中，会造成热点问题，降低查询效率

- 唯一原则

  在设计上保证唯一性

### 设计

- 根据具体业务来设计
- 如果写多，考虑避免热点问题，进行反转（手机号）、加盐（随机盐、hashcode子串盐）
- 如果读多
  - 经常需要连续读，满足某条件的数据连续存放
  - 经常跳跃性查询，数据打散就行
- 用户画像主要是进行跳跃性查询，数据打散即可，两位随机数盐+营业厅编号+用户号
- 加盐可以增加查询的并发性，将数据分为几个部分进行scan操作，查询速度能提升5~20倍
- 有些查询指定营业厅，所以把营业厅编号放在第二位，salt加营业厅编号也保证了不会出现热点问题